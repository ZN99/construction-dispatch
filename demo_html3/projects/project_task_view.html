<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>建築派遣SaaS - 担当案件（派遣スタッフ専用）</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar - 派遣スタッフ専用 -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar">
                <div class="position-sticky pt-3">
                    <div class="d-flex align-items-center px-3 mb-3">
                        <i class="fas fa-user-check text-success me-2"></i>
                        <span class="fw-bold text-success">派遣スタッフ</span>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="../index_staff.html">
                                <i class="fas fa-home me-2"></i>ホーム
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="project_task_view.html">
                                <i class="fas fa-briefcase me-2"></i>担当案件
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../task_dashboard_staff.html">
                                <i class="fas fa-tasks me-2"></i>今日のタスク
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../surveys/survey_execution_mobile.html">
                                <i class="fas fa-mobile-alt me-2"></i>現地調査
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../contact_execution.html">
                                <i class="fas fa-phone me-2"></i>連絡業務
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content - 派遣スタッフ専用 -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <div>
                        <h1 class="h2">担当案件</h1>
                        <small class="text-muted">担当: 田中太郎（派遣スタッフ）</small>
                    </div>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="text-muted">
                            <i class="fas fa-clock me-1"></i>
                            <span id="currentTime"></span>
                        </div>
                    </div>
                </div>

                <!-- 重要な連絡・指示 -->
                <div class="alert alert-warning mb-4" role="alert">
                    <h6 class="alert-heading">
                        <i class="fas fa-exclamation-triangle me-2"></i>社員からの重要な指示
                    </h6>
                    <p class="mb-1">新宿案件の調査時は水道設備を重点的にチェックしてください。</p>
                    <small class="text-muted">指示者: 山田課長 | 時刻: 13:00</small>
                </div>

                <!-- 担当案件一覧（派遣専用：金額情報完全非表示） -->
                <div class="row">
                    <!-- 案件カード1 -->
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-success text-white">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="fas fa-map-marker-alt me-2"></i>港区ワンルーム
                                    </h6>
                                    <span class="badge bg-light text-success">調査完了</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <h6 class="text-muted">お客様情報</h6>
                                    <p class="mb-1 fw-bold">港区賃貸管理株式会社</p>
                                    <p class="mb-1 text-muted">
                                        <i class="fas fa-map-marker-alt me-1"></i>東京都港区○○1-2-3
                                    </p>
                                    <p class="mb-0 text-muted">
                                        <i class="fas fa-phone me-1"></i>03-1234-5678
                                    </p>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-muted">作業内容</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-success me-2"></i>リビング調査</li>
                                        <li><i class="fas fa-check text-success me-2"></i>キッチン調査</li>
                                        <li><i class="fas fa-check text-success me-2"></i>写真撮影</li>
                                        <li><i class="fas fa-check text-success me-2"></i>報告書提出</li>
                                    </ul>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-muted">進捗状況</h6>
                                    <div class="progress mb-2">
                                        <div class="progress-bar bg-success" style="width: 100%">100%</div>
                                    </div>
                                    <small class="text-success">完了日時: 2025-09-15 11:30</small>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-muted">次のアクション</h6>
                                    <p class="text-muted mb-0">社員の承認待ち</p>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="btn-group w-100">
                                    <button class="btn btn-outline-primary" onclick="viewTaskDetails(1)">
                                        <i class="fas fa-eye me-1"></i>詳細
                                    </button>
                                    <button class="btn btn-outline-success" disabled>
                                        <i class="fas fa-check me-1"></i>完了済み
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 案件カード2 -->
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-warning text-white">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="fas fa-map-marker-alt me-2"></i>新宿1K物件
                                    </h6>
                                    <span class="badge bg-light text-warning">調査予定</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <h6 class="text-muted">お客様情報</h6>
                                    <p class="mb-1 fw-bold">新宿不動産管理</p>
                                    <p class="mb-1 text-muted">
                                        <i class="fas fa-map-marker-alt me-1"></i>東京都新宿区△△2-3-4
                                    </p>
                                    <p class="mb-0 text-muted">
                                        <i class="fas fa-phone me-1"></i>03-2345-6789
                                    </p>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-muted">作業内容</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-circle text-warning me-2"></i>水道設備チェック</li>
                                        <li><i class="fas fa-circle text-muted me-2"></i>給水管確認</li>
                                        <li><i class="fas fa-circle text-muted me-2"></i>排水テスト</li>
                                        <li><i class="fas fa-circle text-muted me-2"></i>写真撮影</li>
                                    </ul>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-muted">予定日時</h6>
                                    <p class="mb-1 fw-bold text-primary">
                                        <i class="fas fa-calendar me-1"></i>2025-09-15 14:30-16:00
                                    </p>
                                    <small class="text-muted">所要時間: 約1.5時間</small>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-muted">特記事項</h6>
                                    <div class="alert alert-info mb-0">
                                        <small>水道設備の漏れを重点的にチェック</small>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="btn-group w-100">
                                    <button class="btn btn-primary" onclick="startSurvey(2)">
                                        <i class="fas fa-play me-1"></i>調査開始
                                    </button>
                                    <button class="btn btn-outline-info" onclick="viewMap(2)">
                                        <i class="fas fa-map me-1"></i>地図
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 案件カード3 -->
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-info text-white">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="fas fa-map-marker-alt me-2"></i>品川マンション
                                    </h6>
                                    <span class="badge bg-light text-info">写真提出待ち</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <h6 class="text-muted">お客様情報</h6>
                                    <p class="mb-1 fw-bold">品川マンション管理組合</p>
                                    <p class="mb-1 text-muted">
                                        <i class="fas fa-map-marker-alt me-1"></i>東京都品川区□□3-4-5
                                    </p>
                                    <p class="mb-0 text-muted">
                                        <i class="fas fa-phone me-1"></i>03-3456-7890
                                    </p>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-muted">作業内容</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-success me-2"></i>現地調査</li>
                                        <li><i class="fas fa-check text-success me-2"></i>損傷確認</li>
                                        <li><i class="fas fa-circle text-warning me-2"></i>写真撮影（提出待ち）</li>
                                        <li><i class="fas fa-circle text-muted me-2"></i>報告書作成</li>
                                    </ul>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-muted">進捗状況</h6>
                                    <div class="progress mb-2">
                                        <div class="progress-bar bg-info" style="width: 75%">75%</div>
                                    </div>
                                    <small class="text-info">撮影した写真をアップロードしてください</small>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-muted">期限</h6>
                                    <p class="mb-0 text-danger fw-bold">
                                        <i class="fas fa-clock me-1"></i>本日 17:30 まで
                                    </p>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="btn-group w-100">
                                    <button class="btn btn-warning" onclick="uploadPhotos(3)">
                                        <i class="fas fa-camera me-1"></i>写真アップロード
                                    </button>
                                    <button class="btn btn-outline-primary" onclick="viewTaskDetails(3)">
                                        <i class="fas fa-eye me-1"></i>詳細
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 完了した案件 -->
                    <div class="col-md-6 mb-4">
                        <div class="card h-100 border-success">
                            <div class="card-header bg-light">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0 text-muted">
                                        <i class="fas fa-check-circle me-2"></i>渋谷2DK（完了）
                                    </h6>
                                    <span class="badge bg-success">完了</span>
                                </div>
                            </div>
                            <div class="card-body text-muted">
                                <div class="mb-3">
                                    <h6>お客様情報</h6>
                                    <p class="mb-1">渋谷プロパティ管理</p>
                                    <p class="mb-0">
                                        <i class="fas fa-map-marker-alt me-1"></i>東京都渋谷区○○4-5-6
                                    </p>
                                </div>

                                <div class="mb-3">
                                    <h6>完了日</h6>
                                    <p class="mb-0">2025-09-12 16:00</p>
                                </div>

                                <div class="mb-3">
                                    <h6>実施内容</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-success me-2"></i>全室調査</li>
                                        <li><i class="fas fa-check text-success me-2"></i>写真撮影</li>
                                        <li><i class="fas fa-check text-success me-2"></i>報告書提出</li>
                                        <li><i class="fas fa-check text-success me-2"></i>社員承認済み</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-outline-secondary w-100" onclick="viewCompletedReport(4)">
                                    <i class="fas fa-file-alt me-1"></i>完了報告書を見る
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 本日のスケジュール -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-calendar-day me-2"></i>本日のスケジュール
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="timeline">
                            <div class="timeline-item completed">
                                <div class="timeline-time">11:30</div>
                                <div class="timeline-content">
                                    <div class="fw-bold text-success">港区案件調査完了</div>
                                    <small class="text-muted">報告書提出済み</small>
                                </div>
                            </div>
                            <div class="timeline-item current">
                                <div class="timeline-time">14:30</div>
                                <div class="timeline-content">
                                    <div class="fw-bold text-primary">新宿案件調査開始</div>
                                    <small class="text-primary">水道設備チェック</small>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">17:30</div>
                                <div class="timeline-content">
                                    <div class="fw-bold">品川案件写真提出期限</div>
                                    <small class="text-warning">要注意</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/app.js"></script>
    <script>
        // 派遣スタッフ専用機能

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ja-JP', {
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();

        function startSurvey(projectId) {
            // 調査開始の確認
            if (confirm('新宿案件の調査を開始しますか？')) {
                window.app && window.app.logAuditEvent('SURVEY_STARTED', {
                    projectId: projectId,
                    staffId: 'staff_001',
                    startTime: new Date().toISOString()
                });

                // 調査開始画面に遷移
                window.location.href = `../surveys/survey_execution_mobile.html?project=${projectId}`;
            }
        }

        function uploadPhotos(projectId) {
            window.location.href = `../photo_upload_simple.html?project=${projectId}`;
        }

        function viewTaskDetails(projectId) {
            window.location.href = `project_task_detail.html?id=${projectId}`;
        }

        function viewMap(projectId) {
            // 地図アプリまたは内部地図機能を開く
            const addresses = {
                2: '東京都新宿区△△2-3-4'
            };

            const address = addresses[projectId];
            if (address) {
                const url = `https://maps.google.com/maps?q=${encodeURIComponent(address)}`;
                window.open(url, '_blank');

                window.app && window.app.logAuditEvent('MAP_VIEWED', {
                    projectId: projectId,
                    address: address
                });
            }
        }

        function viewCompletedReport(projectId) {
            window.location.href = `../report_completion.html?project=${projectId}&view=true`;
        }

        // 派遣スタッフの制限事項を確認
        document.addEventListener('DOMContentLoaded', function() {
            // 金額情報を完全非表示（存在しないことを確認）
            const priceElements = document.querySelectorAll('[data-price], .price, .cost, .profit, .budget');
            priceElements.forEach(el => el.remove());

            // 決定権を要する要素を非表示
            const decisionElements = document.querySelectorAll('[data-decision], .approve, .reject, .decide');
            decisionElements.forEach(el => el.remove());

            // 他の派遣スタッフの情報を非表示
            const otherStaffElements = document.querySelectorAll('[data-other-staff]');
            otherStaffElements.forEach(el => el.remove());

            // 監査ログ
            if (window.app) {
                window.app.logAuditEvent('STAFF_TASK_VIEW_ACCESSED', {
                    staffId: 'staff_001',
                    accessTime: new Date().toISOString(),
                    page: 'project_task_view'
                });
            }
        });

        // エラーハンドリング
        window.addEventListener('error', function(e) {
            if (window.app) {
                window.app.logAuditEvent('STAFF_PAGE_ERROR', {
                    error: e.message,
                    page: 'project_task_view',
                    staffId: 'staff_001'
                });
            }
        });

        // セキュリティ：不正アクセス監視
        function checkAccess() {
            const userRole = localStorage.getItem('userRole');
            if (userRole !== 'temporary' && userRole !== 'staff') {
                if (window.app) {
                    window.app.logAuditEvent('UNAUTHORIZED_ACCESS_ATTEMPT', {
                        page: 'project_task_view',
                        attemptedRole: userRole,
                        timestamp: new Date().toISOString()
                    });
                }
                alert('このページへのアクセス権限がありません。');
                window.location.href = '../index.html';
            }
        }

        // アクセスチェック実行
        checkAccess();
    </script>

    <style>
        .timeline {
            position: relative;
            padding-left: 1.5rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #dee2e6;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 1rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -0.75rem;
            top: 0.25rem;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6c757d;
        }

        .timeline-item.completed::before {
            background: #28a745;
        }

        .timeline-item.current::before {
            background: #007bff;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 123, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0); }
        }

        .timeline-time {
            font-size: 0.875rem;
            font-weight: bold;
            color: #007bff;
        }

        .timeline-content {
            margin-top: 0.25rem;
        }

        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card-header {
            font-weight: 600;
        }

        .progress {
            height: 20px;
            border-radius: 10px;
        }

        .progress-bar {
            border-radius: 10px;
        }

        /* 担当者専用のカラーリング */
        .bg-staff-primary {
            background-color: #28a745 !important;
        }

        .text-staff-primary {
            color: #28a745 !important;
        }

        .border-staff-primary {
            border-color: #28a745 !important;
        }
    </style>
</body>
</html>