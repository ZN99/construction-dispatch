<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>派遣スタッフ管理 - 社員専用</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../css/role-separation.css" rel="stylesheet">
</head>
<body data-user-role="employee">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="../index_manager.html">
                <i class="fas fa-users me-2"></i>派遣スタッフ管理
            </a>
            <div class="ms-auto">
                <span class="navbar-text me-3">社員専用</span>
                <a href="../index_manager.html" class="btn btn-outline-light btn-sm">
                    <i class="fas fa-home me-1"></i>ダッシュボード
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- スタッフ管理メニュー -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0"><i class="fas fa-cogs me-2"></i>管理メニュー</h6>
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="#" class="list-group-item list-group-item-action active" onclick="showStaffList()">
                            <i class="fas fa-list me-2"></i>スタッフ一覧
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showTaskAssignment()">
                            <i class="fas fa-tasks me-2"></i>タスク割当
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showPermissionSettings()">
                            <i class="fas fa-shield-alt me-2"></i>権限設定
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showComplianceCheck()">
                            <i class="fas fa-gavel me-2"></i>法令遵守チェック
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showPerformanceMetrics()">
                            <i class="fas fa-chart-line me-2"></i>実績管理
                        </a>
                    </div>
                </div>

                <!-- 緊急アラート -->
                <div class="card mt-3">
                    <div class="card-header bg-warning text-dark">
                        <h6 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>注意事項</h6>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-warning p-2">
                            <small><strong>法令遵守</strong><br>
                            派遣スタッフには決定権限を与えてはいけません（労働者派遣法第23条）</small>
                        </div>
                        <div class="alert alert-info p-2">
                            <small><strong>財務情報</strong><br>
                            金額・利益情報は完全非開示です</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- メインコンテンツエリア -->
            <div class="col-md-9">
                <!-- スタッフ一覧画面 -->
                <div id="staffListView" class="content-view">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-users me-2"></i>派遣スタッフ一覧</h5>
                            <div class="btn-group">
                                <button class="btn btn-primary btn-sm" onclick="addNewStaff()">
                                    <i class="fas fa-user-plus me-1"></i>新規追加
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="exportStaffData()">
                                    <i class="fas fa-download me-1"></i>エクスポート
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>スタッフ情報</th>
                                            <th>現在のタスク</th>
                                            <th>権限レベル</th>
                                            <th>最終ログイン</th>
                                            <th>法令遵守状況</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <img src="https://via.placeholder.com/40" class="rounded-circle me-3" alt="Avatar">
                                                    <div>
                                                        <div class="fw-bold">田中太郎</div>
                                                        <small class="text-muted">ID: TEMP001</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge bg-primary">新宿1K現地調査</span>
                                                <br><small class="text-muted">進捗: 75%</small>
                                            </td>
                                            <td>
                                                <span class="badge bg-success">実行のみ</span>
                                                <br><small class="text-success">✓ 法令準拠</small>
                                            </td>
                                            <td>
                                                <div>2024-12-07 14:23</div>
                                                <small class="text-muted">アクティブ</small>
                                            </td>
                                            <td>
                                                <div class="text-success">
                                                    <i class="fas fa-check-circle me-1"></i>適合
                                                </div>
                                                <small class="text-muted">財務情報非開示</small>
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-primary" onclick="viewStaffDetail('TEMP001')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-outline-warning" onclick="assignTask('TEMP001')">
                                                        <i class="fas fa-tasks"></i>
                                                    </button>
                                                    <button class="btn btn-outline-info" onclick="viewActivity('TEMP001')">
                                                        <i class="fas fa-history"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <img src="https://via.placeholder.com/40" class="rounded-circle me-3" alt="Avatar">
                                                    <div>
                                                        <div class="fw-bold">佐藤次郎</div>
                                                        <small class="text-muted">ID: TEMP002</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge bg-info">渋谷オフィス清掃</span>
                                                <br><small class="text-muted">進捗: 30%</small>
                                            </td>
                                            <td>
                                                <span class="badge bg-success">実行のみ</span>
                                                <br><small class="text-success">✓ 法令準拠</small>
                                            </td>
                                            <td>
                                                <div>2024-12-07 13:45</div>
                                                <small class="text-muted">アクティブ</small>
                                            </td>
                                            <td>
                                                <div class="text-success">
                                                    <i class="fas fa-check-circle me-1"></i>適合
                                                </div>
                                                <small class="text-muted">タスク実行のみ</small>
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-primary" onclick="viewStaffDetail('TEMP002')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-outline-warning" onclick="assignTask('TEMP002')">
                                                        <i class="fas fa-tasks"></i>
                                                    </button>
                                                    <button class="btn btn-outline-info" onclick="viewActivity('TEMP002')">
                                                        <i class="fas fa-history"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <img src="https://via.placeholder.com/40" class="rounded-circle me-3" alt="Avatar">
                                                    <div>
                                                        <div class="fw-bold">鈴木花子</div>
                                                        <small class="text-muted">ID: TEMP003</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge bg-secondary">待機中</span>
                                                <br><small class="text-muted">タスクなし</small>
                                            </td>
                                            <td>
                                                <span class="badge bg-success">実行のみ</span>
                                                <br><small class="text-success">✓ 法令準拠</small>
                                            </td>
                                            <td>
                                                <div>2024-12-07 12:30</div>
                                                <small class="text-warning">非アクティブ</small>
                                            </td>
                                            <td>
                                                <div class="text-success">
                                                    <i class="fas fa-check-circle me-1"></i>適合
                                                </div>
                                                <small class="text-muted">権限制限済み</small>
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-primary" onclick="viewStaffDetail('TEMP003')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-outline-warning" onclick="assignTask('TEMP003')">
                                                        <i class="fas fa-tasks"></i>
                                                    </button>
                                                    <button class="btn btn-outline-info" onclick="viewActivity('TEMP003')">
                                                        <i class="fas fa-history"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- タスク割当画面 -->
                <div id="taskAssignmentView" class="content-view" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>タスク割当管理</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>利用可能なタスク</h6>
                                    <div class="list-group" id="availableTasks">
                                        <div class="list-group-item">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6 class="mb-1">品川マンション現地調査</h6>
                                                    <p class="mb-1">水道設備のチェックと写真撮影</p>
                                                    <small class="text-muted">締切: 2024-12-10</small>
                                                </div>
                                                <button class="btn btn-outline-primary btn-sm" onclick="assignTaskToStaff('TASK001')">
                                                    割当
                                                </button>
                                            </div>
                                        </div>
                                        <div class="list-group-item">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6 class="mb-1">協力会社連絡業務</h6>
                                                    <p class="mb-1">定型メッセージでの連絡作業</p>
                                                    <small class="text-muted">締切: 2024-12-08</small>
                                                </div>
                                                <button class="btn btn-outline-primary btn-sm" onclick="assignTaskToStaff('TASK002')">
                                                    割当
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>割当済みタスク</h6>
                                    <div class="list-group" id="assignedTasks">
                                        <div class="list-group-item">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6 class="mb-1">新宿1K現地調査</h6>
                                                    <p class="mb-1">担当: 田中太郎</p>
                                                    <small class="text-success">進捗: 75%</small>
                                                </div>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-info" onclick="viewTaskProgress('TASK003')">
                                                        進捗
                                                    </button>
                                                    <button class="btn btn-outline-warning" onclick="reassignTask('TASK003')">
                                                        再割当
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 権限設定画面 -->
                <div id="permissionView" class="content-view" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>権限設定・法令遵守</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>重要:</strong> 労働者派遣法第23条により、派遣スタッフに決定権限を与えることは禁止されています。
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <h6>許可されている操作</h6>
                                    <ul class="list-group">
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            タスク実行
                                            <span class="badge bg-success">許可</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            現地調査・写真撮影
                                            <span class="badge bg-success">許可</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            定型メッセージ送信
                                            <span class="badge bg-success">許可</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            チェックリスト記入
                                            <span class="badge bg-success">許可</span>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6>禁止されている操作</h6>
                                    <ul class="list-group">
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            財務情報閲覧
                                            <span class="badge bg-danger">禁止</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            案件承認・決定
                                            <span class="badge bg-danger">禁止</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            価格設定・変更
                                            <span class="badge bg-danger">禁止</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            スタッフ管理
                                            <span class="badge bg-danger">禁止</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- スタッフ詳細モーダル -->
    <div class="modal fade" id="staffDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">スタッフ詳細情報</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="staffDetailContent">
                    <!-- スタッフ詳細情報がここに表示される -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">閉じる</button>
                    <button type="button" class="btn btn-warning" onclick="updateStaffPermissions()">権限更新</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/app.js"></script>
    <script>
        // ページロード時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            // 役割制御の強制実行
            if (typeof window.roleManager !== 'undefined') {
                window.roleManager.enforceRoleSeparation();
                window.roleManager.hideFinancialInfo();
            }

            // 法令遵守のための監査ログ記録
            logAuditEvent('STAFF_MANAGEMENT_ACCESS', 'staff_management.html', 'HR_MANAGEMENT');

            // 初期画面表示
            showStaffList();
        });

        function showStaffList() {
            hideAllViews();
            document.getElementById('staffListView').style.display = 'block';
            updateActiveMenu(0);
            logAuditEvent('VIEW_STAFF_LIST', 'Staff list view accessed', 'HR_MANAGEMENT');
        }

        function showTaskAssignment() {
            hideAllViews();
            document.getElementById('taskAssignmentView').style.display = 'block';
            updateActiveMenu(1);
            logAuditEvent('VIEW_TASK_ASSIGNMENT', 'Task assignment view accessed', 'TASK_MANAGEMENT');
        }

        function showPermissionSettings() {
            hideAllViews();
            document.getElementById('permissionView').style.display = 'block';
            updateActiveMenu(2);
            logAuditEvent('VIEW_PERMISSION_SETTINGS', 'Permission settings view accessed', 'SECURITY_MANAGEMENT');
        }

        function showComplianceCheck() {
            logAuditEvent('COMPLIANCE_CHECK_REQUESTED', 'Compliance check initiated', 'LEGAL_COMPLIANCE');
            alert('法令遵守チェックを実行中...\n\n✓ 派遣スタッフ権限: 適切に制限済み\n✓ 財務情報: 完全非開示\n✓ 決定権限: 全て無効化済み\n\n労働者派遣法第23条に完全準拠しています。');
        }

        function showPerformanceMetrics() {
            logAuditEvent('PERFORMANCE_METRICS_ACCESSED', 'Performance metrics view accessed', 'HR_ANALYTICS');
            alert('実績管理画面は実装中です。\n\n・タスク完了率\n・作業効率指標\n・品質評価\n・法令遵守スコア\n\nなどの指標が表示されます。');
        }

        function hideAllViews() {
            const views = document.querySelectorAll('.content-view');
            views.forEach(view => view.style.display = 'none');
        }

        function updateActiveMenu(index) {
            const menuItems = document.querySelectorAll('.list-group-item');
            menuItems.forEach((item, i) => {
                if (i === index) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        function viewStaffDetail(staffId) {
            const staffData = {
                'TEMP001': {
                    name: '田中太郎',
                    id: 'TEMP001',
                    email: 'tanaka@example.com',
                    phone: '090-1234-5678',
                    currentTask: '新宿1K現地調査',
                    progress: '75%',
                    permissions: ['タスク実行', '写真撮影', '定型連絡'],
                    restrictions: ['財務情報閲覧禁止', '決定権限なし', '価格情報非表示']
                }
            };

            const staff = staffData[staffId] || staffData['TEMP001'];

            const detailContent = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>基本情報</h6>
                        <table class="table table-sm">
                            <tr><td>氏名</td><td>${staff.name}</td></tr>
                            <tr><td>スタッフID</td><td>${staff.id}</td></tr>
                            <tr><td>メール</td><td>${staff.email}</td></tr>
                            <tr><td>電話</td><td>${staff.phone}</td></tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>現在の状況</h6>
                        <table class="table table-sm">
                            <tr><td>現在のタスク</td><td>${staff.currentTask}</td></tr>
                            <tr><td>進捗</td><td>${staff.progress}</td></tr>
                            <tr><td>権限レベル</td><td><span class="badge bg-success">実行のみ</span></td></tr>
                            <tr><td>法令遵守</td><td><span class="text-success">適合</span></td></tr>
                        </table>
                    </div>
                    <div class="col-md-6 mt-3">
                        <h6>許可された操作</h6>
                        <ul class="list-group list-group-flush">
                            ${staff.permissions.map(p => `<li class="list-group-item text-success"><i class="fas fa-check me-2"></i>${p}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="col-md-6 mt-3">
                        <h6>制限事項</h6>
                        <ul class="list-group list-group-flush">
                            ${staff.restrictions.map(r => `<li class="list-group-item text-danger"><i class="fas fa-times me-2"></i>${r}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;

            document.getElementById('staffDetailContent').innerHTML = detailContent;
            new bootstrap.Modal(document.getElementById('staffDetailModal')).show();

            logAuditEvent('STAFF_DETAIL_VIEWED', `Staff detail viewed: ${staffId}`, 'HR_MANAGEMENT');
        }

        function assignTask(staffId) {
            logAuditEvent('TASK_ASSIGNMENT_INITIATED', `Task assignment for staff: ${staffId}`, 'TASK_MANAGEMENT');
            alert(`${staffId} にタスクを割り当てます。\n\n注意: 派遣スタッフには実行タスクのみ割り当て可能です。`);
        }

        function viewActivity(staffId) {
            logAuditEvent('STAFF_ACTIVITY_VIEWED', `Activity log viewed for staff: ${staffId}`, 'HR_MANAGEMENT');
            alert(`${staffId} の活動履歴を表示します。\n\n・ログイン履歴\n・タスク実行履歴\n・アクセス制限記録\n・法令遵守状況`);
        }

        function addNewStaff() {
            logAuditEvent('NEW_STAFF_ADDITION_INITIATED', 'New staff addition process started', 'HR_MANAGEMENT');
            alert('新規スタッフ追加画面を開きます。\n\n自動的に以下が設定されます:\n・実行のみ権限\n・財務情報非表示\n・決定権限なし');
        }

        function exportStaffData() {
            logAuditEvent('STAFF_DATA_EXPORT_REQUESTED', 'Staff data export requested', 'HR_MANAGEMENT');
            alert('スタッフデータをエクスポート中...\n\n個人情報は匿名化されます。');
        }

        function logAuditEvent(action, details, category) {
            const auditLog = {
                timestamp: new Date().toISOString(),
                action: action,
                details: details,
                category: category,
                userId: 'current_user',
                userRole: 'employee',
                complianceRelevant: true
            };

            console.log('監査ログ記録:', auditLog);
        }
    </script>
</body>
</html>