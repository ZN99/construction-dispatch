<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>建築派遣SaaS - 派遣スタッフ用ダッシュボード</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar - 派遣スタッフ専用 -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar">
                <div class="position-sticky pt-3">
                    <div class="d-flex align-items-center px-3 mb-3">
                        <i class="fas fa-user-check text-success me-2"></i>
                        <span class="fw-bold text-success">派遣スタッフ</span>
                    </div>
                    <h5 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>作業メニュー</span>
                    </h5>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="index_staff.html">
                                <i class="fas fa-home me-2"></i>ホーム
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="task_dashboard_staff.html">
                                <i class="fas fa-tasks me-2"></i>今日のタスク
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="surveys/survey_execution_mobile.html">
                                <i class="fas fa-mobile-alt me-2"></i>現地調査
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact_execution.html">
                                <i class="fas fa-phone me-2"></i>連絡業務
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="report_completion.html">
                                <i class="fas fa-clipboard-check me-2"></i>報告提出
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content - 派遣スタッフ専用 -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="text-center pt-3 pb-2 mb-4" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 32px; border-radius: 12px;">
                    <h1 style="font-size: 32px; margin-bottom: 16px;">👋 お疲れ様です！</h1>
                    <h2 style="font-size: 24px; margin-bottom: 8px;">田中太郎さん</h2>
                    <p style="font-size: 18px; margin: 0;">
                        ⏰ 現在時刻：<span id="currentTime" style="font-weight: bold;"></span>
                    </p>
                </div>

                <!-- わかりやすい状況表示 -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 18px;">
                            <div class="card-body text-center py-4">
                                <h2 class="mb-3" style="font-size: 28px;">
                                    <i class="fas fa-clock me-3"></i>次の作業
                                </h2>
                                <h3 class="mb-2" style="font-size: 24px; font-weight: bold;">
                                    新宿1K物件の現地調査
                                </h3>
                                <p class="mb-3" style="font-size: 20px;">
                                    📍 東京都新宿区 | ⏰ 14:30開始予定
                                </p>
                                <div class="mb-3">
                                    <span style="background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-size: 16px;">
                                        💧 水道設備をチェックしてください
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 今日やること（分かりやすいリスト） -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header" style="background: #f8f9fa; border-bottom: 3px solid #007bff;">
                                <h4 class="mb-0" style="font-size: 22px; color: #333;">
                                    📝 今日やること
                                </h4>
                            </div>
                            <div class="card-body" style="padding: 24px;">
                                <!-- 完了済み -->
                                <div class="mb-4" style="background: #e8f5e8; border-left: 5px solid #28a745; padding: 16px; border-radius: 8px;">
                                    <h6 style="color: #155724; margin-bottom: 8px;">✅ 完了済み</h6>
                                    <p style="margin: 0; font-size: 16px;">港区ワンルーム現地調査 → 11:30に完了</p>
                                    <p style="margin: 0; font-size: 16px;">A建設への連絡 → 13:15に完了</p>
                                </div>

                                <!-- 次にやること -->
                                <div class="mb-4" style="background: #fff3cd; border-left: 5px solid #ffc107; padding: 20px; border-radius: 8px;">
                                    <h6 style="color: #856404; margin-bottom: 12px; font-size: 18px;">🔥 次にやること</h6>
                                    <p style="margin: 0; font-size: 20px; font-weight: bold; color: #333;">新宿1K物件の現地調査</p>
                                    <p style="margin: 4px 0 0 0; font-size: 16px; color: #666;">14:30〜16:00 | 水道設備をチェック</p>
                                </div>

                                <!-- 後でやること -->
                                <div style="background: #d1ecf1; border-left: 5px solid #17a2b8; padding: 16px; border-radius: 8px;">
                                    <h6 style="color: #0c5460; margin-bottom: 8px;">⏳ 後でやること</h6>
                                    <p style="margin: 0; font-size: 16px;">B工務店へ連絡 → 17:00まで</p>
                                    <p style="margin: 0; font-size: 16px;">品川案件の写真提出 → 今日中</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 大きなボタン（わかりやすい操作） -->
                    <div class="col-md-4">
                        <div class="card" style="border: 3px solid #007bff; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <div class="card-header text-center" style="background: #007bff; color: white;">
                                <h4 class="mb-0" style="font-size: 20px;">
                                    🚀 ボタンを押してください
                                </h4>
                            </div>
                            <div class="card-body text-center" style="padding: 32px;">
                                <button class="btn btn-success w-100 mb-4" onclick="startSurvey()" style="font-size: 24px; padding: 20px; border-radius: 12px; font-weight: bold;">
                                    📱 現地調査を始める
                                </button>

                                <div style="border-top: 2px solid #eee; margin: 24px 0; padding-top: 20px;">
                                    <p style="margin-bottom: 16px; font-size: 16px; color: #666;">その他の作業</p>
                                    <button class="btn btn-outline-primary w-100 mb-3" onclick="uploadPhoto()" style="font-size: 18px; padding: 12px;">
                                        📷 写真を送る
                                    </button>
                                    <button class="btn btn-outline-secondary w-100" onclick="reportCompletion()" style="font-size: 18px; padding: 12px;">
                                        ✅ 完了報告
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 大事な連絡（わかりやすく表示） -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header" style="background: #fffbf0; border-bottom: 3px solid #ffc107;">
                                <h4 class="mb-0" style="font-size: 22px; color: #333;">
                                    📢 上司からの大事な連絡
                                </h4>
                            </div>
                            <div class="card-body" style="padding: 24px;">
                                <!-- 重要な指示 -->
                                <div class="mb-4" style="background: #fff3cd; border: 2px solid #ffc107; padding: 20px; border-radius: 12px;">
                                    <h5 style="color: #856404; margin-bottom: 12px; font-size: 20px;">⚠️ 新宿案件で注意すること</h5>
                                    <div style="font-size: 18px; line-height: 1.6;">
                                        <p style="margin: 8px 0;"><strong>💧 水道設備をチェックする時：</strong></p>
                                        <div style="margin-left: 20px;">
                                            <p style="margin: 4px 0;">• 給水管から水漏れしていないか</p>
                                            <p style="margin: 4px 0;">• 排水がスムーズに流れるか</p>
                                            <p style="margin: 4px 0;">• 蛇口がちゃんと動くか</p>
                                        </div>
                                        <p style="margin: 12px 0 4px 0; font-size: 16px; color: #666;">📝 山田課長より（13:00の指示）</p>
                                    </div>
                                </div>

                                <!-- その他の連絡 -->
                                <div style="background: #d1ecf1; border: 2px solid #17a2b8; padding: 20px; border-radius: 12px;">
                                    <h5 style="color: #0c5460; margin-bottom: 12px; font-size: 20px;">📷 品川案件の写真について</h5>
                                    <p style="font-size: 18px; margin: 8px 0; line-height: 1.6;">
                                        <strong>部屋全体の写真</strong>と<strong>壊れている部分のアップ写真</strong>を必ず撮ってください。
                                    </p>
                                    <p style="margin: 12px 0 4px 0; font-size: 16px; color: #666;">📝 佐藤主任より（12:30の指示）</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script>
        // 派遣スタッフ専用機能
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ja-JP', {
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        // 1秒ごとに時刻更新
        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();

        function completeTask(taskId) {
            const checkbox = document.getElementById(`task${taskId}`);
            const listItem = checkbox.closest('.list-group-item');
            const badge = listItem.querySelector('.badge');
            const taskText = listItem.querySelector('.fw-bold');

            if (checkbox.checked) {
                // タスク完了処理
                taskText.innerHTML = `<s>${taskText.textContent}</s>`;
                taskText.classList.add('text-muted');
                badge.className = 'badge bg-success';
                badge.textContent = '完了';

                // 完了時刻を追加
                const timeElement = listItem.querySelector('small');
                timeElement.innerHTML = `完了時刻: ${new Date().toLocaleTimeString('ja-JP', {
                    hour: '2-digit',
                    minute: '2-digit'
                })}`;
                timeElement.className = 'text-muted';

                // チェックボックスを無効化
                checkbox.disabled = true;

                // 監査ログ記録
                if (window.app) {
                    window.app.logAuditEvent('TASK_COMPLETED', {
                        taskId: taskId,
                        completedAt: new Date().toISOString(),
                        staffId: 'staff_001'
                    });
                }

                showToast('タスクが完了しました', 'success');
            }
        }

        function startSurvey() {
            window.location.href = 'surveys/survey_execution_mobile.html';
        }

        function uploadPhoto() {
            window.location.href = 'photo_upload_simple.html';
        }


        function reportCompletion() {
            window.location.href = 'report_completion.html';
        }

        function showToast(message, type) {
            if (window.app && window.app.showToast) {
                window.app.showToast(message, type);
            }
        }

        // 派遣スタッフの権限制限チェック
        document.addEventListener('DOMContentLoaded', function() {
            // 金額情報を完全非表示
            const priceElements = document.querySelectorAll('[data-price], .price, .cost, .profit');
            priceElements.forEach(el => el.style.display = 'none');

            // 他の派遣スタッフ情報を非表示
            const staffInfoElements = document.querySelectorAll('[data-staff-info]');
            staffInfoElements.forEach(el => el.style.display = 'none');

            // 決定・承認ボタンを非表示
            const managementButtons = document.querySelectorAll('[data-management], .btn-approve, .btn-decide');
            managementButtons.forEach(el => el.style.display = 'none');
        });
    </script>

    <style>
        .timeline {
            position: relative;
            padding-left: 1.5rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #dee2e6;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 1rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -0.75rem;
            top: 0.25rem;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #007bff;
        }

        .timeline-time {
            font-size: 0.875rem;
            font-weight: bold;
            color: #007bff;
        }

        .timeline-content {
            margin-top: 0.25rem;
        }

        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        .list-group-item {
            border-left: none;
            border-right: none;
        }

        .list-group-item:first-child {
            border-top: none;
        }

        .list-group-item:last-child {
            border-bottom: none;
        }
    </style>
</body>
</html>